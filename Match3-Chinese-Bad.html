<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>L3T3RS å­—æ¯æ¸¸æˆ</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC&display=swap');

    body {
      font-family: 'Noto Sans SC', sans-serif;
      margin: 0;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      background-color: #f2f2f2;
    }

    h1 {
      margin: 0 20px 0 0;
      font-size: 28px;
    }

    #topBar {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }

    .game-button {
      font-size: 18px;
      padding: 6px 12px;
      cursor: pointer;
      border-radius: 6px;
      border: 1px solid #999;
      background-color: #fff;
    }

    #mainGame {
      display: flex;
      gap: 20px;
      justify-content: center;
      max-width: 700px;
      margin: 0 auto 10px auto;
    }

    #gameBoard {
      display: grid;
      grid-template-columns: repeat(8, 50px);
      grid-gap: 5px;
    }

    .cell {
      width: 50px;
      height: 50px;
      display: flex;
      justify-content: center;
      align-items: center;
      border: 1px solid #333;
      font-size: 24px;
      cursor: pointer;
      background-color: #ffffff;
      color: #333;
      transition: background-color 0.3s, box-shadow 0.3s;
      border-radius: 8px;
      box-shadow: 1px 1px 4px rgba(0, 0, 0, 0.2);
    }

    .cell:hover {
      background-color: #e0e0e0;
    }

    .selected {
      background-color: #4caf50 !important;
      color: white !important;
      border: 2px solid #2e7d32;
      box-shadow: 0 0 5px #2e7d32;
    }

    .highlighted {
      background-color: gold;
      color: black;
      font-weight: bold;
    }

    .shake {
      animation: shake 0.2s;
    }

    @keyframes shake {
      0%,100% { transform: translate(0, 0); }
      25% { transform: translate(-2px, 0); }
      50% { transform: translate(2px, 0); }
      75% { transform: translate(-2px, 0); }
    }

    #sidebar {
  width: auto;
  max-width: 400px; /* Increased from 300px */
  font-size: 15px;
  border: 2px solid #ccc;
  padding: 10px;
  background: #fff;
  border-radius: 8px;
  word-wrap: break-word;
  overflow-wrap: break-word;
}

    #score {
      margin-top: 8px;
      font-size: 18px;
    }

    #instructions {
      font-size: 16px;
      margin-top: 10px;
      color: #333;
      max-width: 100%;
      word-wrap: break-word;
      white-space: normal;
      line-height: 1.4em;
    }

    #goalsList {
      list-style: none;
      padding: 0;
      margin: 10px 0 0 0;
    }
    #accordion {
      width: 700px;
      border: 1px solid #ccc;
      margin-top: 20px;
      background-color: #fefefe;
    }

    .accordion-header {
      background-color: #eee;
      padding: 10px;
      cursor: pointer;
      font-weight: bold;
    }

    .accordion-content {
      display: none;
      padding: 10px;
      background-color: #fafafa;
    }

    .accordion-content label {
      display: block;
      margin-top: 10px;
      font-size: 16px;
    }

    #colorButtons {
      display: flex;
      gap: 5px;
      flex-wrap: wrap;
      margin-top: 10px;
    }

    .color-scheme {
      width: 30px;
      height: 30px;
      border: 2px solid;
      border-radius: 50%;
      cursor: pointer;
    }

    .icon-button {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
    }

    #pointsLog {
      width: 700px;
      font-size: 14px;
      border: 1px solid #ddd;
      padding: 10px;
      background-color: #f9f9f9;
      margin-top: 10px;
    }

    .log-entry {
      margin-bottom: 5px;
    }

    .log-letter {
      cursor: pointer;
      color: blue;
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <div id="topBar">
    <h1>L3T3RS å­—æ¯æ¸¸æˆ</h1>
    <button class="game-button" onclick="startGame()">å¼€å§‹æ¸¸æˆ</button>
    <button class="game-button" onclick="resetGame()">é‡ç½®æ¸¸æˆ</button>
  </div>

  <div id="mainGame">
    <div id="gameBoard"></div>
    <div id="sidebar">
      <div><strong>å‰©ä½™æ­¥æ•°:</strong> <span id="movesLeft">15</span></div>
      <div style="margin-top: 10px;"><strong>ç›®æ ‡:</strong></div>
      <ul id="goalsList"></ul>
      <div id="instructions">
        åŒ¹é…å­—æ¯ä»¥å®Œæˆ<br>
        åˆ—å‡ºçš„ç›®æ ‡ã€‚æ¯ä¸ªç›®æ ‡<br>
        ä¼šè·Ÿè¸ªä½ å®Œæˆçš„æ¬¡æ•°ã€‚
      </div>
      <div id="score">å¾—åˆ†: 0</div>
    </div>
  </div>

  <div id="accordion">
    <div class="accordion-header" onclick="toggleAccordion()">æ¸¸æˆé€‰é¡¹ â–¼</div>
    <div class="accordion-content" id="accordionContent">
      <label>
        å£°éŸ³: <button class="icon-button" onclick="toggleSound()" id="soundIcon">ğŸ”Š</button>
      </label>
      <label>å­—æ¯æ•°é‡: <span id="letterCountDisplay">8</span><br>
        <input type="range" id="letterCountSlider" min="2" max="26" value="8" oninput="updateLetterCount()">
      </label>
      <label>æ­¥æ•°: <span id="moveCountDisplay">15</span><br>
        <input type="range" id="moveCountSlider" min="5" max="50" value="15" oninput="updateMoveCount()">
      </label>
      <label><input type="checkbox" id="stretchGoalsCheckbox" checked> åŒ…å«æ‰©å±•ç›®æ ‡ï¼ˆ4æˆ–5ä¸ªåŒ¹é…ï¼‰</label>

      <label>å­—ä½“:
        <select id="fontSelector" onchange="updateFont()">
          <option value="'Noto Sans SC', sans-serif" selected>æ€æºé»‘ä½“</option>
          <option value="'Comic Neue', cursive">Comic Neue</option>
          <option value="'VT323', monospace">VT323</option>
          <option value="'Indie Flower', cursive">Indie Flower</option>
          <option value="'Press Start 2P', cursive">Press Start 2P</option>
          <option value="'Patrick Hand', cursive">Patrick Hand</option>
          <option value="'Shadows Into Light', cursive">Shadows Into Light</option>
          <option value="'Bangers', cursive">Bangers</option>
          <option value="'Caveat', cursive">Caveat</option>
          <option value="'Chewy', cursive">Chewy</option>
          <option value="'Just Me Again Down Here', cursive">Just Me Again</option>
          <option value="'Gloria Hallelujah', cursive">Gloria Hallelujah</option>
          <option value="'Amatic SC', cursive">Amatic SC</option>
          <option value="'Special Elite', cursive">Special Elite</option>
          <option value="'Rubik Doodle Shadow', cursive">Rubik Doodle</option>
          <option value="'Sniglet', cursive">Sniglet</option>
          <option value="'Boogaloo', cursive">Boogaloo</option>
          <option value="'Coming Soon', cursive">Coming Soon</option>
          <option value="'Rock Salt', cursive">Rock Salt</option>
          <option value="'Orbitron', sans-serif">Orbitron</option>
        </select>
      </label>

      <label>é…è‰²æ–¹æ¡ˆ:</label>
      <div id="colorButtons">
        <button class="color-scheme" style="background-color: #00274C; border-color: #FFCB05;" onclick="setColorScheme('#00274C', '#FFCB05')"></button>
        <button class="color-scheme" style="background-color: #FFFFFF; border-color: #333333;" onclick="setColorScheme('#FFFFFF', '#333333')"></button>
        <button class="color-scheme" style="background-color: #FF0000; border-color: #FFFFFF;" onclick="setColorScheme('#FF0000', '#FFFFFF')"></button>
        <button class="color-scheme" style="background-color: #00FF00; border-color: #0000FF;" onclick="setColorScheme('#00FF00', '#0000FF')"></button>
        <button class="color-scheme" style="background-color: #8B00FF; border-color: #FFD700;" onclick="setColorScheme('#8B00FF', '#FFD700')"></button>
        <button class="color-scheme" style="background-color: #FFA500; border-color: #FFFFFF;" onclick="setColorScheme('#FFA500', '#FFFFFF')"></button>
        <button class="color-scheme" style="background-color: #000000; border-color: #FFD700;" onclick="setColorScheme('#000000', '#FFD700')"></button>
        <button class="color-scheme" style="background-color: #000080; border-color: #FFFFFF;" onclick="setColorScheme('#000080', '#FFFFFF')"></button>
        <button class="color-scheme" style="background-color: #FFC0CB; border-color: #800080;" onclick="setColorScheme('#FFC0CB', '#800080')"></button>
        <button class="color-scheme" style="background-color: #00FFFF; border-color: #FF00FF;" onclick="setColorScheme('#00FFFF', '#FF00FF')"></button>
      </div>
    </div>
  </div>

  <div id="pointsLog"></div>
<script>
const gridSize = 8;
let score = 0;
let cells = [];
let randomLetters = [];
let letterSoundEnabled = true;
let selectedAlphabet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
let movesLeft = 15;
let goals = [];

const gameBoard = document.getElementById('gameBoard');
const scoreDisplay = document.getElementById('score');
const pointsLogDisplay = document.getElementById('pointsLog');
const letterCountSlider = document.getElementById('letterCountSlider');
const letterCountDisplay = document.getElementById('letterCountDisplay');
const moveCountSlider = document.getElementById('moveCountSlider');
const moveCountDisplay = document.getElementById('moveCountDisplay');
const soundIcon = document.getElementById('soundIcon');
const goalsList = document.getElementById('goalsList');
const movesLeftDisplay = document.getElementById('movesLeft');
const stretchGoalsCheckbox = document.getElementById('stretchGoalsCheckbox');
const fontSelector = document.getElementById('fontSelector');

function toggleAccordion() {
  const content = document.getElementById('accordionContent');
  content.style.display = content.style.display === 'block' ? 'none' : 'block';
}

function updateLetterCount() {
  letterCountDisplay.textContent = letterCountSlider.value;
}

function updateMoveCount() {
  moveCountDisplay.textContent = moveCountSlider.value;
}

function toggleSound() {
  letterSoundEnabled = !letterSoundEnabled;
  soundIcon.textContent = letterSoundEnabled ? 'ğŸ”Š' : 'ğŸ”‡';
}

function setColorScheme(bg, fg) {
  document.querySelectorAll('.cell').forEach(cell => {
    cell.style.backgroundColor = bg;
    cell.style.color = fg;
  });
}

function updateFont() {
  const font = fontSelector.value;
  document.body.style.fontFamily = font;
}

function getRandomLetter() {
  return randomLetters[Math.floor(Math.random() * randomLetters.length)];
}

function selectRandomLetters() {
  const count = parseInt(letterCountSlider.value);
  const letters = selectedAlphabet.split('');
  randomLetters = [];
  while (randomLetters.length < count && letters.length > 0) {
    const index = Math.floor(Math.random() * letters.length);
    randomLetters.push(...letters.splice(index, 1));
  }
}

function generateGoals() {
  const count = randomLetters.length;
  const stretchEnabled = stretchGoalsCheckbox.checked;
  goals = [];

  let types = [];
  if (stretchEnabled) {
    const num5x = Math.floor(count * 0.2);
    const num4x = Math.floor(count * 0.4);
    const num3x = count - num5x - num4x;
    types = [
      ...Array(num3x).fill(3),
      ...Array(num4x).fill(4),
      ...Array(num5x).fill(5)
    ];
  } else {
    types = Array(count).fill(3);
  }

  types.sort(() => Math.random() - 0.5);

  for (let i = 0; i < count; i++) {
    const letter = randomLetters[i];
    const type = types[i];
    const target = type === 3 ? 3 : (type === 4 ? 2 : 1);
    goals.push({ letter, type, target, progress: 0 });
  }
}

function updateGoalsDisplay() {
  goalsList.innerHTML = '';
  const sorted = [...goals].sort((a, b) => a.type - b.type);
  sorted.forEach(goal => {
    const done = goal.progress >= goal.target;
    const text = `${goal.letter} é…å¯¹ ${goal.type}ä¸ªï¼ˆç›®æ ‡ ${goal.target}ï¼Œå·²å®Œæˆ ${goal.progress}ï¼‰`;
    const li = document.createElement('li');
    li.innerHTML = done ? `<s>${text}</s>` : text;
    goalsList.appendChild(li);
  });
}

function initBoard() {
  selectRandomLetters();
  generateGoals();
  updateGoalsDisplay();
  gameBoard.innerHTML = '';
  cells = [];
  for (let i = 0; i < gridSize * gridSize; i++) {
    const cell = document.createElement('div');
    cell.classList.add('cell');
    cell.dataset.index = i;
    cell.textContent = getRandomLetter();
    cell.addEventListener('click', () => selectCell(cell));
    gameBoard.appendChild(cell);
    cells.push(cell);
  }
  score = 0;
  scoreDisplay.textContent = `å¾—åˆ†: ${score}`;
  movesLeft = parseInt(moveCountSlider.value);
  movesLeftDisplay.textContent = movesLeft;
  pointsLogDisplay.innerHTML = '';
  checkMatches();
}

function startGame() {
  updateLetterCount();
  updateMoveCount();
  updateFont();
  initBoard();
}

function resetGame() {
  startGame();
}

function selectCell(cell) {
  const selected = document.querySelector('.selected');
  if (selected) {
    const i1 = parseInt(selected.dataset.index);
    const i2 = parseInt(cell.dataset.index);
    if (isAdjacent(i1, i2)) {
      swapCells(selected, cell);
      selected.classList.remove('selected');
      checkMatches();
      movesLeft--;
      movesLeftDisplay.textContent = movesLeft;
      if (letterSoundEnabled) speakLetter(cell.textContent);
      checkEndConditions();
    } else {
      selected.classList.remove('selected');
      cell.classList.add('shake');
      setTimeout(() => cell.classList.remove('shake'), 200);
    }
  } else {
    cell.classList.add('selected');
    if (letterSoundEnabled) speakLetter(cell.textContent);
  }
}

function isAdjacent(i1, i2) {
  const r1 = Math.floor(i1 / gridSize), c1 = i1 % gridSize;
  const r2 = Math.floor(i2 / gridSize), c2 = i2 % gridSize;
  return Math.abs(r1 - r2) + Math.abs(c1 - c2) === 1;
}

function swapCells(c1, c2) {
  [c1.textContent, c2.textContent] = [c2.textContent, c1.textContent];
}

function checkMatches() {
  const matchGroups = [];
  for (let i = 0; i < gridSize; i++) {
    for (let j = 0; j < gridSize; j++) {
      const index = i * gridSize + j;
      const letter = cells[index].textContent;
      if (!letter) continue;
      [1, gridSize, gridSize + 1, gridSize - 1].forEach(step => {
        const group = getMatch(index, letter, step);
        if (group.length >= 3) matchGroups.push(group);
      });
    }
  }
  if (matchGroups.length > 0) {
    const flat = [...new Set(matchGroups.flat())];
    highlightMatches(flat, matchGroups);
  } else {
    checkEndConditions();
  }
}

function getMatch(index, letter, step) {
  const match = [index];
  for (let i = 1; i < gridSize; i++) {
    const next = index + step * i;
    if (cells[next] && cells[next].textContent === letter) match.push(next);
    else break;
  }
  return match;
}

function highlightMatches(indices, matchGroups) {
  indices.forEach(i => cells[i].classList.add('highlighted'));
  setTimeout(() => {
    clearMatches(indices, matchGroups);
    applyGravity();
    refillBoard();
    checkMatches();
    checkEndConditions();
  }, 500);
}

function clearMatches(indices, matchGroups) {
  const matchCounts = {};

  matchGroups.forEach(group => {
    const l = cells[group[0]].textContent;
    if (group.every(i => cells[i].textContent === l) && group.length >= 3) {
      matchCounts[l] = matchCounts[l] || [];
      matchCounts[l].push(group.length);
    }
  });

  goals.forEach(goal => {
    if (matchCounts[goal.letter]) {
      matchCounts[goal.letter].forEach(size => {
        if (size >= goal.type) {
          goal.progress++;
        }
      });
    }
  });

  updateGoalsDisplay();
  const points = calculatePoints(indices.length);
  score += points;
  scoreDisplay.textContent = `å¾—åˆ†: ${score}`;
  const letters = indices.map(i => cells[i].textContent);
  pointsLogDisplay.innerHTML += `<div class="log-entry">+${points}ï¼ˆ${letters.join(', ')}ï¼‰</div>`;
  indices.forEach(i => {
    cells[i].classList.remove('highlighted');
    cells[i].textContent = '';
  });
}

function calculatePoints(len) {
  if (len === 3) return 10;
  if (len === 4) return 20;
  if (len === 5) return 30;
  return 50;
}

function applyGravity() {
  for (let c = 0; c < gridSize; c++) {
    for (let r = gridSize - 1; r > 0; r--) {
      let i = r * gridSize + c;
      if (!cells[i].textContent) {
        for (let k = r - 1; k >= 0; k--) {
          let above = k * gridSize + c;
          if (cells[above].textContent) {
            cells[i].textContent = cells[above].textContent;
            cells[above].textContent = '';
            break;
          }
        }
      }
    }
  }
}

function refillBoard() {
  for (let i = 0; i < gridSize * gridSize; i++) {
    if (!cells[i].textContent) {
      cells[i].textContent = getRandomLetter();
    }
  }
}

function speakLetter(letter) {
  const utterance = new SpeechSynthesisUtterance(letter);
  utterance.lang = 'zh-CN';
  window.speechSynthesis.cancel();
  setTimeout(() => window.speechSynthesis.speak(utterance), 100);
}

function checkEndConditions() {
  const allDone = goals.every(goal => goal.progress >= goal.target);
  if (allDone) {
    setTimeout(() => {
      alert("ğŸ‰ æ­å–œä½ å®Œæˆäº†æ‰€æœ‰ç›®æ ‡ï¼\nè¯•ç€ç”¨æ›´å¤šå­—æ¯å†æŒ‘æˆ˜ä¸€æ¬¡ï¼");
    }, 100);
  } else if (movesLeft <= 0) {
    setTimeout(() => {
      alert("æ¸¸æˆç»“æŸã€‚ä½ å·²ç»ç”¨å®Œæ‰€æœ‰æ­¥æ•°ã€‚");
    }, 100);
  }
}

startGame();
</script>
</body>
</html>
